<form th:object="${createReservationForm}" method="post">

    <table class="formtable">

        <!-- First name -->
        <tr>
            <td colspan="2">
                <input type="text" class="form-control" placeholder="First name" th:field="*{customerFirstname}"/>
                <div th:if="${#fields.hasErrors('customerFirstname')}" th:errors="*{customerFirstname}">
                    First name error
                </div>
            </td>
        </tr>

        <!-- Last name -->
        <tr>
            <td colspan="2">
                <input type="text" class="form-control" placeholder="Last name" th:field="*{customerLastname}"/>
                <div th:if="${#fields.hasErrors('customerLastname')}" th:errors="*{customerLastname}">Last name error
                </div>
            </td>
        </tr>

        <!-- Phone number -->
        <tr>
            <td colspan="2">
                <input type="text" class="form-control" placeholder="Phone number" th:field="*{customerPhonenumber}"/>
                <div th:if="${#fields.hasErrors('customerPhonenumber')}" th:errors="*{customerPhonenumber}">Phone number
                    error
                </div>
            </td>
        </tr>

        <!-- Dates arrival / departure-->

        <tr>
            <td>
                <input type="text" th:field="*{arrivalDate}" class="form-control" id="arrivalDate" placeholder="Arrival"
                       readonly="readonly"/>
            </td>
            <td>
                <input type="text" th:field="*{departureDate}" class="form-control" id="departureDate"
                       placeholder="Arrival" readonly="readonly"/>
            </td>
        </tr>

        <!-- Resources-->

        <tr>
            <td>
                Room:
            </td>
            <td>
                <select id="sharedResourceIdSelect" class="form-control" th:field="*{sharedResourceId}">
                    <option th:each="resource : ${sharedResources}"
                            th:value="${resource.getId()}"
                            th:text="${resource.getName()}">Resource name
                    </option>
                </select>
            </td>

        </tr>

        <tr>
            <td>&nbsp;</td>
            <td>
                <button type="button" class="btn btn-default" id="checkRoomAvailabilityBtn">Check availability</button>
            </td>
        </tr>

        <tr>
            <td colspan="2">
                <div th:if="${#fields.hasErrors('sharedResourceId')}" th:errors="*{sharedResourceId}">
                    Shared resource error
                </div>
                <div th:if="${#fields.hasErrors('arrivalDate')}" th:errors="*{arrivalDate}">Arrival error</div>
                <div th:if="${#fields.hasErrors('departureDate')}" th:errors="*{departureDate}">Departure error</div>
                <div th:if="${#fields.hasErrors('token')}" th:text="'Please update form and try again'">Token error
                </div>
                <div th:if="${errorMessage == null || errorMessage.isEmpty() == false}" th:text="${errorMessage}">Error
                    message
                </div>
            </td>
        </tr>

        <!-- Token and submit button -->

        <tr>
            <td colspan="2">

                <!-- Add control token -->
                <input type="hidden" name="token" th:value="${token}"/>

                <button type="submit" class="btn btn-primary">Make a reservation</button>
            </td>
        </tr>

    </table>

    <script th:inline="javascript">
        $(function () {
            $("#arrivalDate").datepicker();
            $("#departureDate").datepicker();

            var roomSelect = $("#sharedResourceIdSelect");
            $("#checkRoomAvailabilityBtn").click(function () {
                var arrival = $("#arrivalDate").val();
                var departure = $("#departureDate").val();

                roomSelect.empty();

                ReservationUtils.getRoomsAvailable(arrival, departure)
                        .then(function (result) {
                            $.each(result, function (index, element) {

                                var elmt = $("<option/>");
                                elmt.text(element.name);
                                elmt.attr("value", element.id);

                                roomSelect.append(elmt);
                            });

                        })
                        .fail(function () {
                            console.error("Fail !");
                            roomSelect.add("<select>Error</select>");
                        })
            });
        });
    </script>

</form>
